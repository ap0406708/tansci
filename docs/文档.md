## 一、概述

### 简介

基于 SpringBoot + Vue3.2 + Element Plus 的后台管理系统，包含基础权限、安全认证、以及常用的一些组件功能。

**项目地址：**

Gitee: [https://gitee.com/typ1805/tansci](https://gitee.com/typ1805/tansci)

GitHub: [https://github.com/typ1805/tansci](https://github.com/typ1805/tansci)

### 架构

#### 1、后端

- SpringBoot 2.6.1
- Mybatis Plus 3.4.3.1
- Spring Security 
- JJWT 0.9.0

#### 2、前端

- vue 3.2.16
- element-plus 1.3.0-beta.1
- vue-router 4.0.12
- vuex 4.0.2
- axios 0.24.0
- less 4.1.2

#### 3、环境要求

- JDK	1.8+
- mysql	5.7+
- node	14+
- npm	6.14+
- Nginx	1.16+
- Maven	3.8+
- Git	2.14+

### 项目结构

<pre>
├─docs                         # 文档相关
├─sql                          # 数据库SQL脚本
├─src                          # 后端项目目录
│  ├─main
│  │  ├─java
│  │  │  └─com
│  │  │      └─tansci
│  │  │          ├─common       # 公共包
│  │  │          ├─config       # 配置
│  │  │          ├─controller   # controller 层
│  │  │          ├─domain       # 映射实体
│  │  │          │  ├─dto       # DTO 实体
│  │  │          │  └─vo        # VO 实体
│  │  │          ├─mapper       # mapper 层
│  │  │          ├─security     # 安全认证相关
│  │  │          ├─service      # service 层
│  │  │          │  └─impl
│  │  │          └─utils        # 工具包
│  │  └─resources
│  │      └─mapper              # mapper XML 映射
│  └─test                       # 测试
└─tansci-view                   # 前端项目目录
    ├─public
    └─src
        ├─api                   # 服务AIP配置
        ├─assets                # 静态资源（包含 公共样式、图片）
        │  ├─css                
        │  └─image
        ├─components            # 公共组件
        ├─layout                # 整体布局
        ├─router                # 路由
        ├─store                 # axios 封装
        ├─utils                 # 工具包
        └─views                 # 功能模块
            └─system            # 基础功能模块
</pre>

## 二、实现的功能

1、基础模块：菜单管理、角色管理、组织管理、用户管理、字典管理、日志管理；

2、消息通知：短信通知、邮件通知；

3、定时任务：动态配置定时任务；

4、支付功能：包含 支付宝、微信、银联等；

5、三方登录：包含 短信、微信、QQ 等三方授权登录方式；

持续更新...

## 三、搭建环境

### 1、后端环境

**1.1、安装JDK 1.8**

1.1.1、下载地址：

[https://www.oracle.com/java/technologies/downloads](https://www.oracle.com/java/technologies/downloads)

> 如下载高版本需要登录，可使用java账号网址: [http://bugmenot.com/view/oracle.com](http://bugmenot.com/view/oracle.com)

1.1.2、配置环境变量：

```
// 配置路径信息

JAVA_HOME: C:\Program Files\Java\jdk1.8.0_112

// CLASSPATH

.;%JAVA_HOME%\lib;

// 配置 Path

%JAVA_HOME%\bin

```

1.1.3、验证是否安装成功

```
C:\Users\acer>java -version
java version "1.8.0_112"
Java(TM) SE Runtime Environment (build 1.8.0_112-b15)
Java HotSpot(TM) 64-Bit Server VM (build 25.112-b15, mixed mode)

```

**1.2、安装mysql 5.7+版本**

1.2.1、下载地址：

[https://www.mysql.com/downloads/](https://www.mysql.com/downloads/)

解压安装包，根据自己的喜好选择路径，我选择的路径是D:\MySQL\，因此MySQL的完整路径为：D:\MySQL\mysql-5.7.21-winx64

1.2.2、配置环境变量

```
// 新增系统环境变量

MYSQL_HOME: D:\MySQL\mysql-5.7.21-winx64

// 配置 Path

%MYSQL_HOME%\bin
```

> 在Path中添加：%MYSQL_HOME%\bin，注意Path中不同值之间的“；”符号不能省略

1.2.3、准备好my.ini文件

可以先新建一个my.txt文件，然后通过重命名修改文件后缀为.ini，以前的版本解压后或许会存在my-default.ini文件，但是5.7.21版本没有，因此要自己手动创建该文件，文件的内容如下：

```
[mysqld]  
port = 3306  
basedir= D:/MySQL/mysql-5.7.21-winx64  
datadir= D:/MySQL/mysql-5.7.21-winx64/data   
max_connections=200  
character-set-server=utf8  
default-storage-engine=INNODB  
sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES  
[mysql]  
default-character-set=utf8  

```

> 此步骤要注意：安装路径的文件夹之间用“/”而不是“\”,否则在下面的操作中可能会出错。编辑好my.ini文件之后，将my.ini文件放D:\MySQL\mysql-5.7.21-winx64

1.2.4、安装MySQL

以管理员身份打开cmd命令窗口，将目录切换到MySQL的安装目录的bin目录下

执行以下语句进行MySQL的安装

```
mysqld -install
```

执行命令后提示：Service successfully installed. 表示安装成功。

**如果报错：** "无法启动此程序，因为计算机中丢失 MSVCR120.dll。尝试重新安装该程序以解决此问题。"

运行vcredist_x64.exe后在执行就不报错了。

1.2.5、执行以下语句进行MySQL的初始化

```
mysqld --initialize-insecure --user=mysql
```

> 执行命令后会在MySQL的安装目录下生成data目录并创建root用户。

1.2.6、执行以下命令以启动mysql服务

```
net start mysql

// 执行后会有如下提示：

 MySQL服务正在启动..
 MySQL服务已经启动成功。

```

1.2.7、启动MySQL之后，root用户的密码为空，设置密码，命令如下：

```
mysqladmin -u root -p password 新密码 

Enter password: 旧密码

```
需要输入旧密码时，由于旧密码为空，所以直接回车即可。

**1.3、安装Maven 3.8+版本**

1.3.1、下载地址：

[https://maven.apache.org/download.cgi](https://maven.apache.org/download.cgi)

> 解压文件：```D:\apache-maven-3.5.4```

1.3.2、配置环境变量

```
// MAVEN_HOME

MAVEN_HOME: D:\apache-maven-3.5.4

// 编辑环境变量Path

%MAVEN_HOME%\bin;

```

1.3.3、验证是否安装成功

```
C:\Users\acer>mvn -v
Apache Maven 3.5.4 (1edded0938998edf8bf061f1ceb3cfdeccf443fe; 2018-06-18T02:33:14+08:00)
Maven home: D:\apache-maven-3.5.4\bin\..
Java version: 1.8.0_112, vendor: Oracle Corporation, runtime: C:\Program Files\Java\jdk1.8.0_112\jre

Default locale: zh_CN, platform encoding: GBK
OS name: "windows 8.1", version: "6.3", arch: "amd64", family: "windows"

```

**1.4、安装Git 2.14+版本**

1.4.1、下载地址：

[https://www.git-scm.com/downloads](https://www.git-scm.com/downloads)

在Windows平台上安装Git非常轻松，运行exe文件即可。

完成安装之后，就可以使用命令行的 git 工具（已经自带了 ssh 客户端）了，另外还有一个图形界面的 Git 项目管理工具。

在开始菜单里找到"Git"->"Git Bash"，会弹出 Git 命令窗口，你可以在该窗口进行 Git 操作。

1.4.2、配置个人的用户名称和电子邮件地址

```
git config --global user.name "tansci"

git config --global user.email tansci@qq.com
```

1.4.3、查看安装版本

```
C:\Users\acer>git --version
git version 2.14.1.windows.1
```

### 2、前端环境

**2.1、安装node、npm**

2.1.1、下载地址：

[https://nodejs.org/en/download](https://nodejs.org/en/download)

2.1.2、安装

运行msi文件傻瓜式安装即可。

安装成功，并且安装过程中已自动配置了环境变量和安装好了npm包，此时可以执行 node -v 和 npm -v 分别查看node和npm的版本号：

```
C:\Users\acer>node -v
v12.14.1

C:\Users\acer>npm -v
6.13.4

```

2.1.3、配置npm在安装全局模块时的路径和缓存cache的路径

因为在执行例如npm install webpack -g等命令全局安装的时候，默认会将模块安装在C:\Users\用户名\AppData\Roaming路径下的npm和npm_cache中，不方便管理且占用C盘空间。

所以这里配置自定义的全局模块安装目录，在node.js安装目录下新建两个文件夹 node_global和node_cache，然后在cmd命令下执行如下两个命令：

```
npm config set prefix "D:\nodejs\node_global"

npm config set cache "D:\nodejs\node_cache"
```

> 注：执行成功后，要配置环境变量 -> 系统变量中新建一个变量名为:
> ``NODE_PATH``， 值为``D:\nodejs\node_modules``
> 最后编辑用户变量里的Path: 将相应npm的路径改为：``D:\nodejs\node_global``

> 以上环境安装如有不详之处，请自行查阅网上资料进行安装完成即可。

## 四、搭建项目

> 开发工具：
> - 后端： ```ideaIU-2020.3.2```
> - 前端： ```VSCode-x64-1.57.1```
> - 后端服务测试工具：Postman（可使用谷歌浏览器插件）
>
> 项目所需开发工具可到此处下载（包含破解）：[https://typ1805.gitee.io/typ1805/toolbox.html](https://typ1805.gitee.io/typ1805/toolbox.html)

### 1、后端项目

#### 1.1、数据库表设计

使用Navicat连接安装好的mysql服务，创建名为```tansci```数据库。

创建表不在此处讲解，直接执行项目目录下```tansci\sql\tansci.sql```的SQL脚本即可。

#### 1.2、项目初始化

1.2.1、创建项目

创建SpringBoot项目，选择版本为 ``2.6.1``即可。创建如下目录：

<pre>
├─src                          
│  ├─main
│  │  ├─java
│  │  │  └─com
│  │  │      └─tansci
│  │  │          ├─common       # 公共包
│  │  │          ├─config       # 配置
│  │  │          ├─controller   # controller 层
│  │  │          ├─domain       # 映射实体
│  │  │          │  ├─dto       # DTO 实体
│  │  │          │  └─vo        # VO 实体
│  │  │          ├─mapper       # mapper 层
│  │  │          ├─security     # 安全认证相关
│  │  │          ├─service      # service 层
│  │  │          │  └─impl
│  │  │          └─utils        # 工具包
│  │  └─resources
│  │      └─mapper              # mapper XML 映射
│  └─test                       # 测试
</pre>

1.2.2、添加依赖（pom.xml）

> 此处的依赖为目前项目功能的所有依赖，可自行按需添加。

```java
<properties>
    <java.version>1.8</java.version>
    <mybatis-plus-boot.version>3.4.3.1</mybatis-plus-boot.version>
    <druid-spring-boot.version>1.2.6</druid-spring-boot.version>
    <fastjson.version>1.2.75</fastjson.version>
    <jsch.version>0.1.55</jsch.version>
    <jjwt.version>0.9.0</jjwt.version>
    <dysmsapi.version>2.0.4</dysmsapi.version>
</properties>

<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter</artifactId>
    </dependency>

    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-security</artifactId>
    </dependency>

    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>

    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-aop</artifactId>
    </dependency>

    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <scope>runtime</scope>
    </dependency>

    <dependency>
        <groupId>com.baomidou</groupId>
        <artifactId>mybatis-plus-boot-starter</artifactId>
        <version>${mybatis-plus-boot.version}</version>
    </dependency>

    <dependency>
        <groupId>com.alibaba</groupId>
        <artifactId>druid-spring-boot-starter</artifactId>
        <version>${druid-spring-boot.version}</version>
    </dependency>

    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <optional>true</optional>
    </dependency>

    <dependency>
        <groupId>com.alibaba</groupId>
        <artifactId>fastjson</artifactId>
        <version>${fastjson.version}</version>
    </dependency>

    <dependency>
        <groupId>com.jcraft</groupId>
        <artifactId>jsch</artifactId>
        <version>${jsch.version}</version>
    </dependency>

    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt</artifactId>
        <version>${jjwt.version}</version>
    </dependency>

    <!-- 邮件 -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-mail</artifactId>
    </dependency>
    <!-- 阿里云短信 -->
    <dependency>
        <groupId>com.aliyun</groupId>
        <artifactId>dysmsapi20170525</artifactId>
        <version>${dysmsapi.version}</version>
    </dependency>

    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
</dependencies>

```

1.2.3、添加配置

在resources目录下将 ```application.properties``` 文件修改为 ```application.yml```格式，新建不同环境的配置文件：

- application.yml

```yml
server:
  port: 8005
  servlet:
    context-path: /tansci/

spring:
  profiles:
    active: dev
  jackson:
    time-zone: GMT+8
    date-format: yyyy-MM-dd HH:mm:ss
  servlet:
    multipart:
      enabled: true
      max-file-size: 100MB
      max-request-size: 100MB
```

> 默认设置为测试环境（dev）

- application-dev.yml

```yml
spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://127.0.0.1:3306/tansci?autoReconnect=true&useUnicode=true&characterEncoding=utf-8&autoReconnect=true
    username: root
    password: admin
    initialSize: 10
    minIdle: 10
    maxActive: 100
    maxWait: 60000
    timeBetweenEvictionRunsMillis: 300000
    minEvictableIdleTimeMillis: 3600000
    validationQuery: SELECT 1 FROM DUAL
    testWhileIdle: true
    testOnBorrow: false
    testOnReturn: false
    poolPreparedStatements: true
    maxPoolPreparedStatementPerConnectionSize: 20

```

- application-pro.yml

```yml
spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://127.0.0.1:3306/tansci?autoReconnect=true&useUnicode=true&characterEncoding=utf-8&autoReconnect=true
    username: root
    password: root
    initialSize: 10
    minIdle: 10
    maxActive: 100
    maxWait: 60000
    timeBetweenEvictionRunsMillis: 300000
    minEvictableIdleTimeMillis: 3600000
    validationQuery: SELECT 1 FROM DUAL
    testWhileIdle: true
    testOnBorrow: false
    testOnReturn: false
    poolPreparedStatements: true
    maxPoolPreparedStatementPerConnectionSize: 20

```

> 以上为配置数据库连接信息

1.2.4、整合Mybatis-Plus

配置文件增加相关配置：

```yml
mybatis-plus:
  mapper-locations: classpath:mapper/**/*.xml
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```

在```src/main/java/com/tansci/config/```目录下创建 ```MybatisPlusConfig.java``` 的分页配置

```java
package com.tansci.config;

import com.baomidou.mybatisplus.annotation.DbType;
import com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;
import com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;
import org.mybatis.spring.annotation.MapperScan;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * @path：com.tansci.config.MybatisPlusConfig.java
 * @className：MybatisPlusConfig.java
 * @description：MybatisPlus分页配置
 * @author：tanyp
 * @dateTime：2021/10/22 15:28
 * @editNote：
 */
@Configuration
@MapperScan("com.tansci.mapper")
public class MybatisPlusConfig {

    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.POSTGRE_SQL));
        return interceptor;
    }

}

```

为了在开发测试中方便定位问题，我们可以自定义打印日志格式、保存目录、日志级别等。在此项目中选择```logback```作为日志框架，并配置myBatis输出SQL语句。

在resources目录下新建 ```logback-spring.xml``` 文件，配置如下：

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<configuration scan="true" dudug="fasle" scanPeriod="5 minutes">

    <!-- ConsoleAppender 控制台输出日志 -->
    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
        <!-- 对日志进行格式化 -->
        <layout class="ch.qos.logback.classic.PatternLayout">
            <pattern>%d %X{mdcData} [%thread] %-5level %c.%method %line - %msg%n</pattern>
        </layout>
    </appender>

    <!-- 配置myBatis输出SQL语句 -->
    <logger name="com.tansci.mapper" level="debug"/>

    <!-- 定义日志的根目录 -->
    <property name="LOG_HOME" value="logs" />

    <!-- ERROR级别日志 -->
    <!-- 滚动记录文件，先将日志记录到指定文件，当符合某个条件时，将日志记录到其他文件 RollingFileAppender-->
    <appender name="ERROR" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <!-- 过滤器，只记录WARN级别的日志 -->
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>ERROR</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
        <!-- 最常用的滚动策略，它根据时间来制定滚动策略.既负责滚动也负责出发滚动 -->
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <!--日志输出位置  可相对、和绝对路径 -->
            <fileNamePattern>${LOG_HOME}/error-log-%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <!-- 除按日志记录之外，还配置了日志文件不能超过5M，若超过5M，日志文件会以索引0开始，命名日志文件，例如log-error-2013-12-21.0.log -->
            <timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
                <maxFileSize>5MB</maxFileSize>
            </timeBasedFileNamingAndTriggeringPolicy>
        </rollingPolicy>
        <!-- 追加方式记录日志 -->
        <append>true</append>
        <!-- 日志文件的格式 -->
        <encoder>
            <pattern>%d %X{mdcData} [%thread] %-5level %c.%method %line - %msg%n</pattern>
            <charset>utf-8</charset>
        </encoder>
    </appender>

    <!-- INFO级别日志 appender -->
    <appender name="INFO" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>INFO</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>${LOG_HOME}/info-log-%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
                <maxFileSize>5MB</maxFileSize>
            </timeBasedFileNamingAndTriggeringPolicy>
        </rollingPolicy>
        <append>true</append>
        <encoder>
            <pattern>%d %X{mdcData} [%thread] %-5level %c.%method %line - %msg%n</pattern>
            <charset>utf-8</charset>
        </encoder>
    </appender>

    <!-- DEBUG级别日志 appender -->
    <appender name="DEBUG" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>DEBUG</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>${LOG_HOME}/debug-log-%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
                <maxFileSize>5MB</maxFileSize>
            </timeBasedFileNamingAndTriggeringPolicy>
        </rollingPolicy>
        <append>true</append>
        <encoder>
            <pattern>%d %X{mdcData} [%thread] %-5level %c.%method %line - %msg%n</pattern>
            <charset>utf-8</charset>
        </encoder>
    </appender>

    <!-- root级别   DEBUG -->
    <root level="INFO">
        <!-- 控制台输出 -->
        <appender-ref ref="STDOUT" />

        <!-- 日志文件 -->
<!--        <appender-ref ref="ERROR" />-->
<!--        <appender-ref ref="INFO" />-->
<!--        <appender-ref ref="DEBUG" />-->
    </root>
</configuration>

```

> 启动项目验证整合Mybatis-Plus整合是否有问题，也可创建测试类对Mybatis-Plus进行单元测试。

### 2、前端项目

#### 1.1、项目初始化


## 五、功能开发

### 基础功能

#### 1、菜单管理

**1.1、后端接口开发**

**1.2、前端页面开发**

**1.3、前后端联调测试**

#### 2、角色管理

#### 3、组织管理

#### 4、用户管理

#### 5、字典管理

#### 6、日志管理

